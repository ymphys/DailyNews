INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
INFO | Clamping 'from' for query 0 to 2-day window (was 2025-12-03T00:28:27.247866+00:00).
INFO | Requesting everything with params={'q': '("人工智能" OR "AI" OR "大模型")', 'searchIn': 'title,description,content', 'language': 'zh', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-03T06:05:01.020619+00:00'}
INFO | NewsAPI returned 20 articles (status=ok, remaining=None)
INFO | Retained 20 articles for endpoint=everything, language=zh after filtering.
INFO | Clamping 'from' for query 1 to 2-day window (was 2025-12-03T00:28:27.247866+00:00).
INFO | Requesting everything with params={'q': '("artificial intelligence" OR "AI" OR "large language model" OR "LLM")', 'searchIn': 'title,description', 'language': 'en', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-03T06:05:01.728114+00:00'}
INFO | NewsAPI returned 26 articles (status=ok, remaining=None)
INFO | Retained 26 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 19 articles (status=ok, remaining=None)
INFO | Retained 19 articles for endpoint=everything, language=en after filtering.
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
INFO | Summarizing 39 articles across 10 batches.
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Summarizing 26 articles across 7 batches.
INFO | Completed batch 1/10 (briefings=4).
INFO | Completed batch 1/7 (briefings=4).
INFO | Completed batch 2/10 (briefings=8).
INFO | Completed batch 2/7 (briefings=8).
INFO | Completed batch 3/10 (briefings=12).
INFO | Completed batch 3/7 (briefings=12).
INFO | Completed batch 4/7 (briefings=16).
INFO | Completed batch 4/10 (briefings=16).
INFO | Completed batch 5/7 (briefings=20).
INFO | Completed batch 5/10 (briefings=20).
INFO | Completed batch 6/7 (briefings=24).
INFO | Completed batch 7/7 (briefings=26).
INFO | OpenAI summarization completed across 7 batches (model=gpt-4.1-mini-2025-04-14, total_tokens=16146)
INFO | Saved digest to digests/头条简报-2025-12-05_1407.md
INFO | Sent digest email to 1047962614@qq.com.
INFO | Headline run summary: {"started_at": "2025-12-05T06:05:01.019180+00:00", "digest_id": "global_headlines", "digest_display": "Global Headlines", "newsapi": {"key": "1942...4460", "last_run_filter": "2025-12-03T00:13:39.556279+00:00", "requests": [{"endpoint": "top-headlines", "request_params": {"country": "us", "excludeDomains": "www.epsn.com,www.chicago.suntimes.com,www.nfl.com", "pageSize": 30}, "status": "ok", "total_results": 37, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": null, "country": "us", "query_index": 0, "query_params": {"endpoint": "top-headlines", "country": "us", "excludeDomains": "www.epsn.com,www.chicago.suntimes.com,www.nfl.com", "pageSize": 30}}, {"endpoint": "top-headlines", "request_params": {"country": "cn", "pageSize": 30}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": null, "country": "cn", "query_index": 1, "query_params": {"endpoint": "top-headlines", "country": "cn", "pageSize": 30}}, {"endpoint": "top-headlines", "request_params": {"country": "tw", "pageSize": 30}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": null, "country": "tw", "query_index": 2, "query_params": {"endpoint": "top-headlines", "country": "tw", "pageSize": 30}}, {"endpoint": "top-headlines", "request_params": {"country": "fr", "pageSize": 30}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": null, "country": "fr", "query_index": 3, "query_params": {"endpoint": "top-headlines", "country": "fr", "pageSize": 30}}, {"endpoint": "top-headlines", "request_params": {"country": "de", "pageSize": 30}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": null, "country": "de", "query_index": 4, "query_params": {"endpoint": "top-headlines", "country": "de", "pageSize": 30}}, {"endpoint": "top-headlines", "request_params": {"country": "ru", "pageSize": 30}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": null, "country": "ru", "query_index": 5, "query_params": {"endpoint": "top-headlines", "country": "ru", "pageSize": 30}}, {"endpoint": "top-headlines", "request_params": {"country": "it", "pageSize": 30}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": null, "country": "it", "query_index": 6, "query_params": {"endpoint": "top-headlines", "country": "it", "pageSize": 30}}, {"endpoint": "top-headlines", "request_params": {"country": "es", "pageSize": 30}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": null, "country": "es", "query_index": 7, "query_params": {"endpoint": "top-headlines", "country": "es", "pageSize": 30}}]}, "openai": {"key": "sk-p..._AUA", "usage": {"model": "gpt-4.1-mini-2025-04-14", "input_tokens": 6786, "output_tokens": 9360, "total_tokens": 16146}}, "outputs": {"digest_path": "digests/头条简报-2025-12-05_1407.md", "articles_summarized": 26, "recipients": ["1047962614@qq.com"]}}
Wrote headline digest to digests/头条简报-2025-12-05_1407.md
INFO | Completed batch 6/10 (briefings=24).
INFO | Completed batch 7/10 (briefings=28).
INFO | Completed batch 8/10 (briefings=32).
INFO | Completed batch 9/10 (briefings=36).
INFO | Completed batch 10/10 (briefings=39).
INFO | OpenAI summarization completed across 10 batches (model=gpt-4.1-mini-2025-04-14, total_tokens=28441)
INFO | Saved digest to digests/ai-briefing-2025-12-05_1408.md
INFO | Sent digest email to jiabaozhang098@gmail.com.
INFO | Topic run summary: {"started_at": "2025-12-05T06:05:01.019180+00:00", "digest_ids": ["ai"], "newsapi": {"key": "1942...4460", "last_run_filter": {"global_headlines": "2025-12-03T00:13:39.556279+00:00", "china_economy": "2025-12-05T00:28:27.247866+00:00", "ai": "2025-12-05T06:05:01.019180+00:00", "entertainment": "2025-12-05T00:28:27.247866+00:00"}, "requests": [{"endpoint": "everything", "request_params": {"q": "(\"人工智能\" OR \"AI\" OR \"大模型\")", "searchIn": "title,description,content", "language": "zh", "pageSize": 20, "sortBy": "publishedAt", "from": "2025-12-03T06:05:01.020619+00:00"}, "status": "ok", "total_results": 870, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": "zh", "query_index": 0, "query_params": {"endpoint": "everything", "q": "(\"人工智能\" OR \"AI\" OR \"大模型\")", "searchIn": "title,description,content", "language": "zh", "pageSize": 20, "sortBy": "publishedAt"}}, {"endpoint": "everything", "request_params": {"q": "(\"artificial intelligence\" OR \"AI\" OR \"large language model\" OR \"LLM\")", "searchIn": "title,description", "language": "en", "pageSize": 20, "sortBy": "publishedAt", "from": "2025-12-03T06:05:01.728114+00:00"}, "status": "ok", "total_results": 1554, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": "en", "query_index": 1, "query_params": {"endpoint": "everything", "q": "(\"artificial intelligence\" OR \"AI\" OR \"large language model\" OR \"LLM\")", "searchIn": "title,description", "language": "en", "pageSize": 20, "sortBy": "publishedAt"}}]}, "openai": {"key": "sk-p..._AUA", "model": "gpt-4.1-mini-2025-04-14", "usage": {"input_tokens": 13883, "output_tokens": 14558, "total_tokens": 28441}}, "outputs": [{"digest_id": "ai", "digest_display": "Artificial Intelligence", "digest_path": "digests/ai-briefing-2025-12-05_1408.md", "articles_summarized": 39, "recipients": ["jiabaozhang098@gmail.com"]}]}
Wrote 1 topic digests:
 - digests/ai-briefing-2025-12-05_1408.md
INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
INFO | NewsAPI returned 28 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | No articles retrieved for headline digest; nothing to summarize.
No new headline articles found.
INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
INFO | Requesting everything with params={'q': '("经济") OR ("政治") OR ("习近平")  OR ("共产党")', 'searchIn': 'title,description', 'language': 'zh', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-06T00:00:00.247866+00:00'}
INFO | NewsAPI returned 26 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=everything, language=zh after filtering.
INFO | Requesting everything with params={'q': '("China") AND (("Economy") OR ("Politics")) OR ("Xi Jinping") OR ("Communist Party")', 'searchIn': 'title,description', 'language': 'en', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-06T00:00:00.247866+00:00'}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=everything, language=en after filtering.
INFO | No articles retrieved for digest 'china_economy'; skipping.
INFO | Requesting everything with params={'q': '("人工智能" OR "AI" OR "大模型")', 'searchIn': 'title,description,content', 'language': 'zh', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-06T00:00:00.187923+00:00'}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=everything, language=zh after filtering.
INFO | Requesting everything with params={'q': '("artificial intelligence" OR "AI" OR "large language model" OR "LLM")', 'searchIn': 'title,description', 'language': 'en', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-06T00:00:00.187923+00:00'}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=everything, language=en after filtering.
INFO | No articles retrieved for digest 'ai'; skipping.
INFO | Requesting everything with params={'q': '("movies" OR "films" OR "TV shows" OR "entertainment")', 'searchIn': 'title,description', 'language': 'en', 'pageSize': 20, 'sortBy': 'popularity', 'from': '2025-12-06T00:00:00.247866+00:00'}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=everything, language=en after filtering.
INFO | No articles retrieved for digest 'entertainment'; skipping.
INFO | Topic run summary: {"started_at": "2025-12-07T00:00:01.511967+00:00", "digest_ids": [], "newsapi": {"key": "1942...4460", "last_run_filter": {"global_headlines": "2025-12-06T00:00:00.381923+00:00", "ai": "2025-12-06T00:00:00.187923+00:00", "china_economy": "2025-12-06T00:00:00.247866+00:00", "entertainment": "2025-12-06T00:00:00.247866+00:00"}, "requests": [{"endpoint": "everything", "request_params": {"q": "(\"经济\") OR (\"政治\") OR (\"习近平\")  OR (\"共产党\")", "searchIn": "title,description", "language": "zh", "pageSize": 20, "sortBy": "publishedAt", "from": "2025-12-06T00:00:00.247866+00:00"}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": "zh", "query_index": 0, "query_params": {"endpoint": "everything", "q": "(\"经济\") OR (\"政治\") OR (\"习近平\")  OR (\"共产党\")", "searchIn": "title,description", "language": "zh", "pageSize": 20, "sortBy": "publishedAt"}}, {"endpoint": "everything", "request_params": {"q": "(\"China\") AND ((\"Economy\") OR (\"Politics\")) OR (\"Xi Jinping\") OR (\"Communist Party\")", "searchIn": "title,description", "language": "en", "pageSize": 20, "sortBy": "publishedAt", "from": "2025-12-06T00:00:00.247866+00:00"}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": "en", "query_index": 1, "query_params": {"endpoint": "everything", "q": "(\"China\") AND ((\"Economy\") OR (\"Politics\")) OR (\"Xi Jinping\") OR (\"Communist Party\")", "searchIn": "title,description", "language": "en", "pageSize": 20, "sortBy": "publishedAt"}}, {"endpoint": "everything", "request_params": {"q": "(\"人工智能\" OR \"AI\" OR \"大模型\")", "searchIn": "title,description,content", "language": "zh", "pageSize": 20, "sortBy": "publishedAt", "from": "2025-12-06T00:00:00.187923+00:00"}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": "zh", "query_index": 0, "query_params": {"endpoint": "everything", "q": "(\"人工智能\" OR \"AI\" OR \"大模型\")", "searchIn": "title,description,content", "language": "zh", "pageSize": 20, "sortBy": "publishedAt"}}, {"endpoint": "everything", "request_params": {"q": "(\"artificial intelligence\" OR \"AI\" OR \"large language model\" OR \"LLM\")", "searchIn": "title,description", "language": "en", "pageSize": 20, "sortBy": "publishedAt", "from": "2025-12-06T00:00:00.187923+00:00"}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": "en", "query_index": 1, "query_params": {"endpoint": "everything", "q": "(\"artificial intelligence\" OR \"AI\" OR \"large language model\" OR \"LLM\")", "searchIn": "title,description", "language": "en", "pageSize": 20, "sortBy": "publishedAt"}}, {"endpoint": "everything", "request_params": {"q": "(\"movies\" OR \"films\" OR \"TV shows\" OR \"entertainment\")", "searchIn": "title,description", "language": "en", "pageSize": 20, "sortBy": "popularity", "from": "2025-12-06T00:00:00.247866+00:00"}, "status": "ok", "total_results": 0, "rate_limit": {"limit": null, "remaining": null, "reset": null}, "language": "en", "query_index": 0, "query_params": {"endpoint": "everything", "q": "(\"movies\" OR \"films\" OR \"TV shows\" OR \"entertainment\")", "searchIn": "title,description", "language": "en", "pageSize": 20, "sortBy": "popularity"}}]}, "openai": {"key": "sk-p..._AUA", "model": null, "usage": {"input_tokens": 0, "output_tokens": 0, "total_tokens": 0}}, "outputs": []}
No topic digests generated.
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | No articles retrieved for headline digest; nothing to summarize.
No new headline articles found.
INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
WARNING | HTTP error fetching top-headlines (attempt 1/3): [Errno 54] Connection reset by peer. Retrying in 8 seconds.
INFO | NewsAPI returned 28 articles (status=ok, remaining=None)
INFO | Retained 27 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
Traceback (most recent call last):
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 36, in <module>
    main()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 30, in main
    run_headlines()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/headline.py", line 99, in main
    briefings, openai_usage = summarize_articles(articles)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 490, in summarize_articles
    client, api_mode = _build_llm_client()
                       ^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 484, in _build_llm_client
    if not OPENAI_API_KEY:
           ^^^^^^^^^^^^^^
NameError: name 'OPENAI_API_KEY' is not defined
INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
INFO | Clamping 'from' for query 0 to 2-day window (was 2025-12-06T00:00:00.247866+00:00).
INFO | Requesting everything with params={'q': '("经济") OR ("政治") OR ("习近平")  OR ("共产党")', 'searchIn': 'title,description', 'language': 'zh', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-07T00:00:00.992384+00:00'}
INFO | NewsAPI returned 27 articles (status=ok, remaining=None)
INFO | Retained 27 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 20 articles (status=ok, remaining=None)
INFO | Retained 20 articles for endpoint=everything, language=zh after filtering.
INFO | Clamping 'from' for query 1 to 2-day window (was 2025-12-06T00:00:00.247866+00:00).
INFO | Requesting everything with params={'q': '("China") AND (("Economy") OR ("Politics")) OR ("Xi Jinping") OR ("Communist Party")', 'searchIn': 'title,description', 'language': 'en', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-07T00:00:01.728701+00:00'}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
INFO | NewsAPI returned 20 articles (status=ok, remaining=None)
INFO | Retained 20 articles for endpoint=everything, language=en after filtering.
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
Traceback (most recent call last):
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 36, in <module>
    main()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 32, in main
    run_topics()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/topic.py", line 130, in main
    briefings, usage = summarize_articles(articles)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 490, in summarize_articles
    client, api_mode = _build_llm_client()
                       ^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 484, in _build_llm_client
    if not OPENAI_API_KEY:
           ^^^^^^^^^^^^^^
NameError: name 'OPENAI_API_KEY' is not defined
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
Traceback (most recent call last):
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 36, in <module>
    main()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 30, in main
    run_headlines()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/headline.py", line 99, in main
    briefings, openai_usage = summarize_articles(articles)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 490, in summarize_articles
    client, api_mode = _build_llm_client()
                       ^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 484, in _build_llm_client
    if not OPENAI_API_KEY:
           ^^^^^^^^^^^^^^
NameError: name 'OPENAI_API_KEY' is not defined
INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
INFO | NewsAPI returned 25 articles (status=ok, remaining=None)
INFO | Retained 25 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
Traceback (most recent call last):
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 36, in <module>
    main()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 30, in main
    run_headlines()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/headline.py", line 99, in main
    briefings, openai_usage = summarize_articles(articles)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 490, in summarize_articles
    client, api_mode = _build_llm_client()
                       ^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 484, in _build_llm_client
    if not OPENAI_API_KEY:
           ^^^^^^^^^^^^^^
NameError: name 'OPENAI_API_KEY' is not defined
INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
INFO | Clamping 'from' for query 0 to 2-day window (was 2025-12-06T00:00:00.247866+00:00).
INFO | Requesting everything with params={'q': '("经济") OR ("政治") OR ("习近平")  OR ("共产党")', 'searchIn': 'title,description', 'language': 'zh', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-09T00:00:00.777155+00:00'}
INFO | NewsAPI returned 20 articles (status=ok, remaining=None)
INFO | Retained 20 articles for endpoint=everything, language=zh after filtering.
INFO | Clamping 'from' for query 1 to 2-day window (was 2025-12-06T00:00:00.247866+00:00).
INFO | Requesting everything with params={'q': '("China") AND (("Economy") OR ("Politics")) OR ("Xi Jinping") OR ("Communist Party")', 'searchIn': 'title,description', 'language': 'en', 'pageSize': 20, 'sortBy': 'publishedAt', 'from': '2025-12-09T00:00:01.598891+00:00'}
INFO | NewsAPI returned 23 articles (status=ok, remaining=None)
INFO | Retained 23 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 20 articles (status=ok, remaining=None)
INFO | Retained 20 articles for endpoint=everything, language=en after filtering.
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
Traceback (most recent call last):
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 36, in <module>
    main()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 32, in main
    run_topics()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/topic.py", line 130, in main
    briefings, usage = summarize_articles(articles)
                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 490, in summarize_articles
    client, api_mode = _build_llm_client()
                       ^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 484, in _build_llm_client
    if not OPENAI_API_KEY:
           ^^^^^^^^^^^^^^
NameError: name 'OPENAI_API_KEY' is not defined
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
Traceback (most recent call last):
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 36, in <module>
    main()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 30, in main
    run_headlines()
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/headline.py", line 99, in main
    briefings, openai_usage = summarize_articles(articles)
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 490, in summarize_articles
    client, api_mode = _build_llm_client()
                       ^^^^^^^^^^^^^^^^^^^
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 484, in _build_llm_client
    if not OPENAI_API_KEY:
           ^^^^^^^^^^^^^^
NameError: name 'OPENAI_API_KEY' is not defined
Traceback (most recent call last):
Traceback (most recent call last):
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 11, in <module>
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/main.py", line 11, in <module>
    from headline import main as run_headlines
    from headline import main as run_headlines
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/headline.py", line 14, in <module>
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/headline.py", line 14, in <module>
    from mailer import send_digest_via_email
    from mailer import send_digest_via_email
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/mailer.py", line 13, in <module>
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/mailer.py", line 13, in <module>
    from digest_utils import DIGEST_DIR, LOGGER
    from digest_utils import DIGEST_DIR, LOGGER
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 53, in <module>
  File "/Users/zhangjiabao/Project/LLM_Dev/DailyNews/digest_utils.py", line 53, in <module>
    NEWS_API_KEY = os.environ["NEWSAPI_ORG_KEY"]
    NEWS_API_KEY = os.environ["NEWSAPI_ORG_KEY"]
                   ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
                   ~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "<frozen os>", line 714, in __getitem__
  File "<frozen os>", line 714, in __getitem__
KeyError: 'NEWSAPI_ORG_KEY'
KeyError: 'NEWSAPI_ORG_KEY'
INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
INFO | NewsAPI returned 26 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | No articles retrieved for headline digest; nothing to summarize.
No new headline articles found.
INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
INFO | NewsAPI returned 26 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | No articles retrieved for headline digest; nothing to summarize.
No new headline articles found.
INFO | Requesting top-headlines with params={'country': 'us', 'excludeDomains': 'www.epsn.com,www.chicago.suntimes.com,www.nfl.com', 'pageSize': 30}
INFO | NewsAPI returned 26 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'cn', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'tw', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'fr', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'de', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'ru', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'it', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | Requesting top-headlines with params={'country': 'es', 'pageSize': 30}
INFO | NewsAPI returned 0 articles (status=ok, remaining=None)
INFO | Retained 0 articles for endpoint=top-headlines, language=unknown after filtering.
INFO | No articles retrieved for headline digest; nothing to summarize.
No new headline articles found.
